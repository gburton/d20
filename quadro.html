<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Quadro 501 Darts Scorer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-start justify-center p-4">
  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-5xl space-y-6">
    <!-- TOP INPUT AREA -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
      <!-- P 1 PANEL -->
      <div class="text-center space-y-2">
        <h2 class="font-semibold">P1</h2>
        <div class="text-5xl font-extrabold" id="legs1">0</div>
        <div class="text-xs">LEGS</div>
        <div id="score1" class="text-5xl text-red-500 font-bold">501</div>
      </div>

      <!-- INPUT PANEL -->
      <div class="text-center space-y-2">
        <div id="currentPlayerDisplay" class="text-5xl font-bold">P1</div>
        <input id="sharedInput" type="number" min="0" max="240" placeholder="Enter 0â€“240" autofocus
               class="w-full border rounded p-2 text-center">
        <button onclick="submitScore()" class="w-full bg-blue-600 text-white rounded p-2">Submit Score</button>
        <div id="status" class="text-sm font-semibold"></div>
      </div>

      <!-- PLAYER 2 PANEL -->
      <div class="text-center space-y-2">
        <h2 class="font-semibold">P2</h2>
        <div class="text-5xl font-extrabold" id="legs2">0</div>
        <div class="text-xs">LEGS</div>
        <div id="score2" class="text-5xl text-red-500 font-bold">501</div>
      </div>
    </div>

    <!-- SCORE COLUMNS -->
    <div class="grid grid-cols-2 gap-6">
    
    
        
      <div>
      
        <table class="w-full text-center table-fixed">
          <thead>
            <tr class="bg-black text-white">
              <th>100+</th>
              <th>140+</th>
              <th>180+</th>
              <th>200+</th>
              <th>240</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="p1_100">0</td>
              <td id="p1_140">0</td>
              <td id="p1_180">0</td>
              <td id="p1_200">0</td>
              <td id="p1_240">0</td>
            </tr>
          </tbody>
        </table>
        
        <ul id="list1" class="border rounded p-2 space-y-1 max-h-64 overflow-y-auto text-center"></ul>
      </div>
      <div>
        <table class="w-full text-center table-fixed">
          <thead>
            <tr class="bg-black text-white">
              <th>100+</th>
              <th>140+</th>
              <th>180+</th>
              <th>200+</th>
              <th>240</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="p2_100">0</td>
              <td id="p2_140">0</td>
              <td id="p2_180">0</td>
              <td id="p2_200">0</td>
              <td id="p2_240">0</td>
            </tr>
          </tbody>
        </table>
        
        <ul id="list2" class="border rounded p-2 space-y-1 max-h-64 overflow-y-auto text-center"></ul>
      </div>
    </div>

    <!-- CONTROL BUTTONS -->
    <div class="grid grid-cols-2 gap-4">
      <button onclick="newLeg()" class="w-full bg-blue-200 rounded p-2 font-semibold">New Leg (Same Players)</button>
      <button onclick="resetGame()" class="w-full bg-gray-200 rounded p-2 font-semibold">Reset Game (New Players)</button>
    </div>
  </div>

  <script>
    // ====== STATE ======
Â  Â  let scores = { 1: 501, 2: 501 };

Â  Â  // âœ… PER-LEG HISTORY (resets on new leg)
Â  Â  let history = { 1: [], 2: [] };Â 

Â  Â  // âœ… MATCH-LONG STATS (persist across legs)
Â  Â  let stats = {
Â  Â  Â  1: { s100: 0, s140: 0, s180: 0, s200: 0, s240: 0 },
Â  Â  Â  2: { s100: 0, s140: 0, s180: 0, s200: 0, s240: 0 }
Â  Â  };

Â  Â  let currentPlayer = 1;
Â  Â  let legs = { 1: 0, 2: 0 };

Â  Â  const inputEl = document.getElementById("sharedInput");

Â  Â  // ====== PERSISTENCE (Added for data retention) ======
Â  Â  function saveState() {
Â  Â  Â  const state = { scores, history, stats, currentPlayer, legs };
Â  Â  Â  localStorage.setItem("quadro501_state", JSON.stringify(state));
Â  Â  }

Â  Â  function loadState() {
Â  Â  Â  const raw = localStorage.getItem("quadro501_state");
Â  Â  Â  if (!raw) return;

Â  Â  Â  try {
Â  Â  Â  Â  const state = JSON.parse(raw);
Â  Â  Â  Â  scores = state.scores || scores;
Â  Â  Â  Â  history = state.history || { 1: [], 2: [] }; 
Â  Â  Â  Â  stats = state.stats || stats;
Â  Â  Â  Â  currentPlayer = state.currentPlayer || 1;
Â  Â  Â  Â  legs = state.legs || legs;
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.warn("Failed to restore state", e);
Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  function syncUI() {
Â  Â  Â  updateScore(1, scores[1]);
Â  Â  Â  updateScore(2, scores[2]);
Â  Â  Â  updateLegs();
Â  Â  Â  renderStats(1);
Â  Â  Â  renderStats(2);
Â  Â  Â  renderHistory();
Â  Â  Â  updateCurrentPlayerDisplay();
Â  Â  Â  if (scores[1] === 0 || scores[2] === 0) disableInput();
Â  Â  Â  else enableInput();
Â  Â  }
Â  Â  // =======================================================
Â  Â  
Â  Â  
Â  Â  // --- ALWAYS KEEP INPUT FOCUSED ---
Â  Â  setInterval(() => {
Â  Â  Â  if (!inputEl.disabled) inputEl.focus();
Â  Â  }, 300);

Â  Â  // --- ENTER KEY SUBMISSION ---
Â  Â  inputEl.addEventListener("keydown", (e) => {
Â  Â  Â  if (e.key === "Enter") submitScore();
Â  Â  });

Â  Â  function submitScore() {
Â  Â  Â  const value = parseInt(inputEl.value);

Â  Â  Â  if (isNaN(value) || value < 0 || value > 240) {
Â  Â  Â  Â  alert("Invalid score. Must be between 0 and 240.");
Â  Â  Â  Â  inputEl.value = "";
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const newScore = scores[currentPlayer] - value;

Â  Â  Â  // FIX: Added newScore === 1 check for bust rule
Â  Â  Â  if (newScore < 0 || newScore === 1) { 
Â  Â  Â  Â  history[currentPlayer].push({ value, bust: true });
Â  Â  Â  Â  setStatus(`Bust! P${currentPlayer} remains at ${scores[currentPlayer]}.`);
Â  Â  Â  }Â 
Â  Â  Â  else if (newScore === 0) {
Â  Â  Â  Â  history[currentPlayer].push({ value, bust: false });
Â  Â  Â  Â  applyStats(currentPlayer, value);
Â  Â  Â  Â  updateScore(currentPlayer, 0);
Â  Â  Â  Â  renderHistory();

Â  Â  Â  Â  legs[currentPlayer]++;
Â  Â  Â  Â  updateLegs();

Â  Â  Â  Â  setStatus(`ðŸŽ¯ P${currentPlayer} wins the leg`);
Â  Â  Â  Â  disableInput();
Â  Â  Â  Â  saveState(); // Save state on win
Â  Â  Â  Â  return;
Â  Â  Â  }Â 
Â  Â  Â  else {
Â  Â  Â  Â  history[currentPlayer].push({ value, bust: false });
Â  Â  Â  Â  applyStats(currentPlayer, value);
Â  Â  Â  Â  updateScore(currentPlayer, newScore);
Â  Â  Â  Â  setStatus(`P${currentPlayer} scored ${value}`);
Â  Â  Â  }

Â  Â  Â  renderHistory();
Â  Â  Â  inputEl.value = "";
Â  Â  Â  currentPlayer = currentPlayer === 1 ? 2 : 1;
Â  Â  Â  updateCurrentPlayerDisplay();
Â  Â  Â  saveState(); // Save state after every submission
Â  Â  }

Â  Â  // âœ… EXCLUSIVE STAT BUCKETS (MATCH-LONG)
Â  Â  function applyStats(player, value) {
Â  Â  Â  if (value >= 240) stats[player].s240++;
Â  Â  Â  else if (value >= 200) stats[player].s200++;
Â  Â  Â  else if (value >= 180) stats[player].s180++;
Â  Â  Â  else if (value >= 140) stats[player].s140++;
Â  Â  Â  else if (value >= 100) stats[player].s100++;

Â  Â  Â  renderStats(player);
Â  Â  }
Â  Â  
Â  Â  // Added helper function to reset player's match stats
Â  Â  function resetPlayerStats(player) {
Â  Â  Â  stats[player] = { s100: 0, s140: 0, s180: 0, s200: 0, s240: 0 };
Â  Â  }


Â  Â  function renderStats(player) {
Â  Â  Â  document.getElementById(`p${player}_100`).textContent = stats[player].s100;
Â  Â  Â  document.getElementById(`p${player}_140`).textContent = stats[player].s140;
Â  Â  Â  document.getElementById(`p${player}_180`).textContent = stats[player].s180;
Â  Â  Â  document.getElementById(`p${player}_200`).textContent = stats[player].s200;
Â  Â  Â  document.getElementById(`p${player}_240`).textContent = stats[player].s240;
Â  Â  }

Â  Â  function updateScore(player, score) {
Â  Â  Â  scores[player] = score;
Â  Â  Â  document.getElementById(`score${player}`).textContent = score;
Â  Â  }

Â  Â  function updateLegs() {
Â  Â  Â  document.getElementById("legs1").textContent = legs[1];
Â  Â  Â  document.getElementById("legs2").textContent = legs[2];
Â  Â  }

    // âœ… FINAL COSMETIC FIX: Ensured list item content is rendered on one compact line
Â  Â  function renderHistory() {
      const list1 = document.getElementById("list1");
      const list2 = document.getElementById("list2");

      list1.innerHTML = history[1].map((turn, i) => `<li onclick="editScore(1, ${i})" class="cursor-pointer hover:underline text-3xl">${turn.bust ? `BUST (${turn.value})` : turn.value}</li>`).join("");

      list2.innerHTML = history[2].map((turn, i) => `<li onclick="editScore(2, ${i})" class="cursor-pointer hover:underline text-3xl">${turn.bust ? `BUST (${turn.value})` : turn.value}</li>`).join("");
      
      // Scroll to bottom on history updates
      list1.scrollTop = list1.scrollHeight;
      list2.scrollTop = list2.scrollHeight;
    }

Â  Â  // âœ… ROBUST EDIT SCORE
Â  Â  function editScore(player, index) {
Â  Â  Â  const oldTurn = history[player][index];
Â  Â  Â  const input = prompt(`Edit P${player} Turn ${index + 1} score (0â€“240):`, oldTurn.value);
Â  Â  Â  if (input === null) return;

Â  Â  Â  const newValue = parseInt(input);
Â  Â  Â  if (isNaN(newValue) || newValue < 0 || newValue > 240) return;
Â  Â  Â  
Â  Â  Â  // 1. Determine the score adjustment
Â  Â  Â  let scoreAdjustment = 0;
Â  Â  Â  
Â  Â  Â  if (oldTurn.bust) {
Â  Â  Â  Â  // If it was a bust, the score didn't change, so we subtract the new value from current score
Â  Â  Â  Â  scoreAdjustment = -newValue; 
Â  Â  Â  } else {
Â  Â  Â  Â  // If it was a score, we restore the old value and subtract the new one
Â  Â  Â  Â  scoreAdjustment = oldTurn.value - newValue;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const potentialNewScore = scores[player] + scoreAdjustment;

Â  Â  Â  // 2. Check for bust/win condition
Â  Â  Â  if (potentialNewScore < 0 || potentialNewScore === 1) {
Â  Â  Â  Â  alert("Error: That change results in a score less than 0 or exactly 1. Edit aborted.");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // 3. Apply changes to history and score
Â  Â  Â  history[player][index].value = newValue;
Â  Â  Â  history[player][index].bust = false; // Assume corrected score is not a bust (if bust, alert above prevents)
Â  Â  Â  
Â  Â  Â  updateScore(player, potentialNewScore);
Â  Â  Â  
Â  Â  Â  // 4. Recalculate stats for the player after a score edit (reset and re-apply all turns)
Â  Â  Â  resetPlayerStats(player);
Â  Â  Â  history[player].forEach(turn => {
Â  Â  Â  Â  if (!turn.bust) applyStats(player, turn.value);
Â  Â  Â  });

Â  Â  Â  renderHistory();
Â  Â  Â  renderStats(player);
Â  Â  Â  saveState();
Â  Â  Â  
Â  Â  Â  setStatus(`âœ… P${player} Turn ${index + 1} score corrected to ${newValue}.`);
Â  Â  Â  enableInput();
Â  Â  }

Â  Â  // âœ… NEW LEG â†’ SCORES + HISTORY RESET, STATS + LEGS PERSIST
Â  Â  function newLeg() {
Â  Â  Â  scores = { 1: 501, 2: 501 };
Â  Â  Â  history = { 1: [], 2: [] };

Â  Â  Â  updateScore(1, 501);
Â  Â  Â  updateScore(2, 501);
Â  Â  Â  renderHistory();

Â  Â  Â  currentPlayer = 1;
Â  Â  Â  updateCurrentPlayerDisplay();
Â  Â  Â  enableInput();
Â  Â  Â  inputEl.value = "";
Â  Â  Â  setStatus("New leg started â€“ stats preserved");
Â  Â  Â  saveState();
Â  Â  }

Â  Â  function resetGame() {
Â  Â  Â  // Added confirmation for hard reset
Â  Â  Â  if (!confirm("Are you sure you want to reset the entire match history and stats?")) return;

Â  Â  Â  scores = { 1: 501, 2: 501 };
Â  Â  Â  history = { 1: [], 2: [] };
Â  Â  Â  legs = { 1: 0, 2: 0 };

Â  Â  Â  stats = {
Â  Â  Â  Â  1: { s100: 0, s140: 0, s180: 0, s200: 0, s240: 0 },
Â  Â  Â  Â  2: { s100: 0, s140: 0, s180: 0, s200: 0, s240: 0 }
Â  Â  Â  };
Â  Â  Â  
Â  Â  Â  localStorage.removeItem("quadro501_state"); // Clear saved data

Â  Â  Â  renderStats(1);
Â  Â  Â  renderStats(2);
Â  Â  Â  updateLegs();
Â  Â  Â  updateScore(1, 501);
Â  Â  Â  updateScore(2, 501);
Â  Â  Â  renderHistory();

Â  Â  Â  currentPlayer = 1;
Â  Â  Â  updateCurrentPlayerDisplay();
Â  Â  Â  enableInput();
Â  Â  Â  inputEl.value = "";
Â  Â  Â  setStatus("Game fully reset.");
Â  Â  }

Â  Â  function setStatus(msg) {
Â  Â  Â  document.getElementById("status").textContent = msg;
Â  Â  }

Â  Â  function updateCurrentPlayerDisplay() {
Â  Â  Â  document.getElementById("currentPlayerDisplay").textContent = `P${currentPlayer}`;
Â  Â  }

Â  Â  function disableInput() { inputEl.disabled = true; }
Â  Â  function enableInput() { inputEl.disabled = false; inputEl.focus(); }
Â  Â  
Â  Â  // ====== INITIALIZATION (Added for persistence) ======
Â  Â  loadState();
Â  Â  syncUI();
  </script>
</body>
</html>
